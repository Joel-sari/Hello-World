<div id="editProfileModal" class="modal hidden">
  <div class="modal-content" style="width:340px;">
    <style>
      #editProfileForm label {
        display: block;
        margin-top: 12px;
        font-weight: 600;
        color: #e2e8f0;
      }

      #editProfileForm input[type="text"],
      #editProfileForm textarea,
      #editProfileForm select {
        width: 100%;
        margin-top: 6px;
        padding: 6px 8px;
        border-radius: 6px;
        border: 1px solid #2c3440;
        background: #0f172a;
        color: #e2e8f0;
      }

      #editProfileForm input[type="file"] {
        margin-top: 6px;
        color: #e2e8f0;
      }

      .avatar-mode-options label {
        font-weight: 500;
        margin-right: 18px;
        cursor: pointer;
      }
    </style>

    <h3>Edit Profile</h3>

    <form id="editProfileForm" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- USERNAME -->
      <label>Username</label>

      <input type="text" value="{{ user.username }}" disabled />

      <!-- BIO -->
      <label>Bio</label>
      <textarea name="bio" rows="3">{{ user.profile.bio }}</textarea>

      <!-- AVATAR SECTION (new) -->
      <label>Avatar</label>

      <!-- Avatar Preview -->
      <div style="text-align:center; margin-top: 8px;">
        <img
          id="profile-avatar-preview"
          src="{% if user.profile.avatar_upload %}
                  {{ user.profile.avatar_upload.url }}
               {% else %}
                  https://api.dicebear.com/9.x/{{ user.profile.avatar_style }}/svg?seed={{ user.profile.avatar_seed|default:user.username }}
               {% endif %}"
          alt="Avatar Preview"
          style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #2dd4bf; object-fit: cover;"
        />
      </div>

      <!-- Avatar Mode Selection -->
      <div class="avatar-mode-options" style="margin-top: 12px;">
        <label>
          <input type="radio" name="avatar_mode" value="generated"
            {% if not user.profile.avatar_upload %}checked{% endif %}>
          Use Generated Avatar
        </label>

        <label>
          <input type="radio" name="avatar_mode" value="upload"
            {% if user.profile.avatar_upload %}checked{% endif %}>
          Upload Custom Image
        </label>
      </div>

      <!-- Generated Avatar Controls -->
      <div id="generated-avatar-controls" style="margin-top: 10px; {% if user.profile.avatar_upload %}display:none{% endif %}">
        <label>Avatar Style</label>
        <select id="avatar-style-select" name="avatar_style">
          <option value="pixel-art" {% if user.profile.avatar_style == "pixel-art" %}selected{% endif %}>Pixel Art</option>
          <option value="bottts" {% if user.profile.avatar_style == "bottts" %}selected{% endif %}>Bottts</option>
          <option value="identicon" {% if user.profile.avatar_style == "identicon" %}selected{% endif %}>Identicon</option>
        </select>

        <button
          type="button"
          id="shuffle-avatar-btn"
          style="margin-top: 10px; background: #0ea5e9; color: white; padding: 6px 12px; border-radius: 8px; width:100%;">
          Shuffle Avatar
        </button>

        <input type="hidden" id="avatar-seed-input" name="avatar_seed"
               value="{{ user.profile.avatar_seed|default:user.username }}">
      </div>

      <!-- Upload Avatar Controls -->
      <div id="upload-avatar-controls" style="margin-top: 10px; {% if not user.profile.avatar_upload %}display:none{% endif %}">
        <input type="file" name="avatar_upload" id="avatar-upload-input" accept="image/*" />
      </div>

      <!-- BUTTONS -->
      <div class="modal-buttons" style="margin-top: 16px;">
        <button type="button" id="cancelEditProfile" class="btn-secondary">Cancel</button>
        <button type="submit" id="saveEditProfile" class="btn-primary">Save</button>
      </div>

    </form>
  </div>
</div>
